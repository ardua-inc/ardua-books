{% extends "base.html" %}
{% load formatting %}

{% block container_class %}container-wide{% endblock %}

{% block content %}
<div class="report-header">
    <div class="report-title-section">
        <h1>Account Detail: {{ account.code }} - {{ account.name }}</h1>
        {% if from_date or to_date %}
        <p class="report-date-range">
            {% if from_date and to_date %}
            {{ from_date|date:"M d, Y" }} - {{ to_date|date:"M d, Y" }}
            {% elif from_date %}
            From {{ from_date|date:"M d, Y" }}
            {% elif to_date %}
            Through {{ to_date|date:"M d, Y" }}
            {% endif %}
        </p>
        {% else %}
        <p class="report-date-range">All Time</p>
        {% endif %}
    </div>
    <div class="report-actions">
        <a href="javascript:history.back()" class="btn btn-secondary btn-sm">Back</a>
    </div>
</div>

<div class="account-info card mb-3">
    <div class="info-row">
        <div class="info-item">
            <span class="info-label">Account Type</span>
            <span class="info-value">{{ account.get_type_display }}</span>
        </div>
        <div class="info-item">
            <span class="info-label">Total Entries</span>
            <span class="info-value">{{ lines|length }}</span>
        </div>
    </div>
</div>

{% if lines %}
<table class="table table-striped table-bordered">
    <thead>
        <tr>
            <th>Date</th>
            <th>JE #</th>
            <th>Description</th>
            <th class="text-end">Debit</th>
            <th class="text-end">Credit</th>
            <th>Source</th>
        </tr>
    </thead>
    <tbody>
        {% for item in lines %}
        <tr>
            <td>{{ item.je.posted_at|date:"Y-m-d" }}</td>
            <td>
                <a href="{% url 'accounting:journal_detail' item.je.pk %}">JE #{{ item.je.pk }}</a>
            </td>
            <td>{{ item.je.description }}</td>
            <td class="text-end">
                {% if item.line.debit %}
                    {{ item.line.debit|currency }}
                {% endif %}
            </td>
            <td class="text-end">
                {% if item.line.credit %}
                    {{ item.line.credit|currency }}
                {% endif %}
            </td>
            <td>
                {% if item.source_url %}
                    <a href="{{ item.source_url }}" class="btn btn-sm btn-outline-primary">{{ item.source_label }}</a>
                {% else %}
                    <span class="text-muted">-</span>
                {% endif %}
            </td>
        </tr>
        {% endfor %}
    </tbody>
    <tfoot>
        <tr class="totals-row">
            <th colspan="3" class="text-right">Totals:</th>
            <th class="text-end">
                {% with total_debit=0 %}
                {% for item in lines %}
                    {% if item.line.debit %}
                    {% endif %}
                {% endfor %}
                {% endwith %}
            </th>
            <th class="text-end"></th>
            <th></th>
        </tr>
    </tfoot>
</table>
{% else %}
<div class="alert alert-info">
    No journal entries found for this account in the selected date range.
</div>
{% endif %}

<style>
.report-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 1.5rem;
}

.report-title-section h1 {
    margin: 0 0 0.25rem 0;
    font-size: 1.5rem;
}

.report-date-range {
    margin: 0;
    color: #6b7280;
    font-size: 0.95rem;
}

.account-info {
    padding: 1rem;
}

.info-row {
    display: flex;
    gap: 2rem;
}

.info-item {
    display: flex;
    flex-direction: column;
    gap: 0.25rem;
}

.info-label {
    font-size: 0.85rem;
    color: #6b7280;
}

.info-value {
    font-size: 1rem;
    font-weight: 600;
}

.table th,
.table td {
    vertical-align: middle;
}

.text-end {
    text-align: right;
}

.text-right {
    text-align: right;
}

.text-muted {
    color: #9ca3af;
}

.totals-row {
    background: #f3f4f6;
    font-weight: 600;
}

.alert-info {
    background-color: #dbeafe;
    border: 1px solid #93c5fd;
    color: #1e40af;
    padding: 1rem;
    border-radius: 4px;
}

@media (max-width: 768px) {
    .report-header {
        flex-direction: column;
        gap: 1rem;
    }

    .info-row {
        flex-direction: column;
        gap: 1rem;
    }
}
</style>
{% endblock %}
