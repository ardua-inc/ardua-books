{% extends "base.html" %}

{% block content %}
<h1>Client Balance Summary</h1>

<table class="table">
    <thead>
        <tr>
            <th><a href="?sort=name" class="{% if sort == 'name' %}text-primary{% endif %}">Client</a></th>
            <th><a href="?sort=total_invoiced" class="{% if sort == 'total_invoiced' %}text-primary{% endif %}">Total Invoiced</th><a></a></th>
            <th><a href="?sort=applied" class="{% if sort == 'applied' %}text-primary{% endif %}">Applied Payments</a></th>
            <th><a href="?sort=unapplied" class="{% if sort == 'unapplied' %}text-primary{% endif %}">Unapplied Payments</a></th>
            <th><a href="?sort=outstanding" class="{% if sort == 'outstanding' %}text-primary{% endif %}">Outstanding AR</a></th>
            <th><a href="?sort=net_ar" class="{% if sort == 'net_ar' %}text-primary{% endif %}">Net Position</a></th>
            <th></th>
        </tr>
    </thead>

    <tbody>
        {% for row in summary %}
        <tr>
            <td>{{ row.client.name }}</td>
            <td>{{ row.total_invoiced|floatformat:2 }}</td>
            <td>{{ row.applied|floatformat:2 }}</td>
            <td>{{ row.unapplied|floatformat:2 }}</td>
            <td>{{ row.outstanding|floatformat:2 }}</td>
            <td>
                    {% if row.net_ar > 0 %}
                        <span class="text-danger fw-bold">{{ row.net_ar|floatformat:2 }}</span>
                    {% elif row.net_ar < 0 %}
                        <span class="text-success fw-bold">{{ row.net_ar|floatformat:2 }}</span>
                    {% else %}
                        <span class="text-muted">{{ row.net_ar|floatformat:2 }}</span>
                    {% endif %}
                            </td>
            <td>
                <a href="{% url 'billing:client_edit' row.client.id %}">
                    View Client
                </a>
            </td>
            <td>
                <a href="{% url 'billing:invoice_list' %}?client={{ row.client.id }}">Invoices</a>
                |
                <a href="{% url 'accounting:payment_list' %}?client={{ row.client.id }}">Payments</a>
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>

{% endblock %}
